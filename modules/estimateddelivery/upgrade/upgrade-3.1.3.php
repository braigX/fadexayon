<?php
/** * Estimated Delivery - Front Office Feature
 *
 * NOTICE OF LICENSE
 *
 * @author    Pol RuÃ©
 * @copyright Smart Modules 2015
 * @license   http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 *
 * @category Transport & Logistics
 * Registered Trademark & Property of smart-modules.com
 * ***************************************************
 * *               Estimated Delivery                *
 * *          http://www.smart-modules.com           *
 * *                                                  *
 * ***************************************************
 */
if (!defined('_PS_VERSION_')) {
    exit;
}

function upgrade_module_3_1_3($module)
{
    if (!Configuration::hasKey('ED_EMAIL_DATE_FORMAT')) {
        Configuration::updateValue('ED_EMAIL_DATE_FORMAT', 3);
    }
    // Remove the override, now the email template is covered without the need of an override.
    $module->uninstallOverrides();
    if (file_exists(dirname(__FILE__) . '/../override')) {
        deleteDirectory(dirname(__FILE__) . '/../override');
    }

    return true;
}

function deleteDirectory($dir)
{
    if (!file_exists($dir)) {
        return true;
    }
    if (!is_dir($dir)) {
        return unlink($dir);
    }
    foreach (scandir($dir) as $item) {
        if ($item == '.' || $item == '..') {
            continue;
        }
        if (!deleteDirectory($dir . DIRECTORY_SEPARATOR . $item)) {
            return false;
        }
    }

    return rmdir($dir);
}
