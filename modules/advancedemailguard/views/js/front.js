/**
 * Advanced Anti Spam PrestaShop Module.
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License version 3.0
 * that is bundled with this package in the file LICENSE.md.
 * It is also available through the world-wide-web at this URL:
 * https://opensource.org/licenses/AFL-3.0
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@prestashop.com so we can send you a copy immediately.
 *
 * @author    ReduxWeb
 * @copyright 2017-2023 reduxweb.net
 * @license   https://opensource.org/licenses/AFL-3.0 Academic Free License version 3.0
 */
var AdvancedEmailGuard=function(){"use strict";function i(){return!0===c.drm}function a(){return t.split(" ").map(function(t){return String.fromCharCode(t)}).join("").replace("{{date}}",(new Date).getFullYear())}function n(){if(h.isObj(s.recaptcha.forms)){if(v("contact_us",p.ps.v17pc?"form:has(button[name=submitMessage], input[name=submitMessage])":"form:not(#id_new_comment_form):has(button[name=submitMessage], input[name=submitMessage])"),v("register",p.ps.v17?"body:not(#checkout):not(#identity) form:has(button[name=submitCreate], input[name=submitCreate])":C()?"#opc_account_form:visible:has(button[name=submitAccount], input[name=submitAccount])":"form:has(button[name=submitAccount], input[name=submitAccount])"),v("login",p.ps.v17?"form:has(button[name=submitLogin], input[name=submitLogin])":"form:has(button[name=SubmitLogin], input[name=SubmitLogin])"),v("reset_password",p.ps.v17?"form.forgotten-password, body#password #content form:first":"#form_forgotpassword",p.ps.v17?"button[type=submit]:visible, input[type=submit]:visible":"button[type=submit], input[type=submit]"),v("quick_order",p.ps.v17?"body#checkout form:has(button[name=submitCreate], input[name=submitCreate])":C()?"#opc_account_form:visible:has(button[name=submitGuestAccount], input[name=submitGuestAccount])":"#new_account_form"),v("newsletter",p.ps.v15?"form:has(button[name=submitNewsletter], input[name=submitNewsletter]):visible":"form:has(button[name=submitNewsletter], input[name=submitNewsletter])",p.ps.v17?"button[type=submit]:visible, input[type=submit]:visible":"button[type=submit], input[type=submit]"),v("write_review",p.ps.v17pc?"#post-product-comment-form":"#id_new_comment_form"),v("notify_when_in_stock",c.isLegacyMAModuleEnabled?"form:has(#mailalert_link)":".js-mailalert",c.isLegacyMAModuleEnabled?"":"button[type=submit], input[type=submit], button:first"),v("send_to_friend","#send_friend_form_content"),s.recaptcha.hidden&&$("#"+b).length===0)s.recaptcha.hidden=false;for(var t in s.recaptcha.forms){h.recaptchaForms[t]=[];switch(t){case"register":if(!p.ps.v17){$(document).ajaxSuccess(function(t,e,i,a){var n=h.queryToObj(i.data);if(n.controller==="authentication"&&h.isDef(n.SubmitCreate)&&!a.hasError)setTimeout(function(){h.initRecaptchaForm("register")},700)});if(C()){$(document).on("click","#opc_createAccount",function(){setTimeout(function(){h.initRecaptchaForm("register")},700)});$(document).ajaxSend(function(t,e,i){var a=h.queryToObj(i.data);if(a.ajax==="true"&&h.isDef(a.submitAccount)&&a.is_new_customer==="1")i.data+=h.getRecFormTokenAsPayload("register")})}}break;case"login":if(C())$(document).ajaxSend(function(t,e,i){var a=h.queryToObj(i.data);if(a.ajax==="true"&&h.isDef(a.SubmitLogin))i.data+=h.getRecFormTokenAsPayload("login")});break;case"quick_order":if(C()){$(document).on("click","#opc_guestCheckout",function(){setTimeout(function(){h.initRecaptchaForm("quick_order")},700)});$(document).ajaxSend(function(t,e,i){var a=h.queryToObj(i.data);if(a.ajax==="true"&&h.isDef(a.submitAccount)&&a.is_new_customer==="0")i.data+=h.getRecFormTokenAsPayload("quick_order")})}break;case"notify_when_in_stock":var r=c.isLegacyMAModuleEnabled?"mailalerts":"ps_emailalerts";$(document).ajaxSend(function(t,e,i){if(i.url.includes(r)&&i.url.includes("process=add"))i.data+=h.getRecFormTokenAsPayload("notify_when_in_stock")});if(!c.isLegacyMAModuleEnabled)$(document).ajaxSuccess(function(t,e,i,a){var n=h.queryToObj(i.data);if(i.url.includes("controller=product")&&n.action==="refresh")h.initRecaptchaForm("notify_when_in_stock")});if(S())$(document).ajaxSuccess(function(t,e,i,a){if(i.url.includes(r)&&/process=(add|check)/.test(i.url)){var n=false;if(c.isLegacyMAModuleEnabled)n=a==="1";else try{var o=JSON.parse(a);n=o.error===false}catch(t){}if(n&&h.isDef(h.recaptchaForms["notify_when_in_stock"]))h.recaptchaForms["notify_when_in_stock"].forEach(function(t){if(!t.$submit.is(":visible"))t.hideWidget()})}});break;case"send_to_friend":$(document).ajaxSend(function(t,e,i){var a=h.queryToObj(i.data);if(a.action==="sendToMyFriend")i.data+=h.getRecFormTokenAsPayload("send_to_friend")});break}}s.recaptcha.deferred&&!function(){var t=[],e;for(e in s.recaptcha.forms)if(h.isDef(y[e]))t.push(y[e].form);return t.length!==0&&$(t.join(",")).length!==0}()||e(o)}}function e(t){var e,i;F||(e="?render=explicit&onload="+d,"shop"===s.recaptcha.language&&(e+="&hl="+p.languageCode),i=t,window[d]=function(){F||(F=!0,k(),"function"==typeof h.googleRecaptchaCallbackBefore&&h.googleRecaptchaCallbackBefore(),i(),"function"==typeof h.googleRecaptchaCallback&&h.googleRecaptchaCallback())},$("head").append('<script src="https://www.google.com/recaptcha/api.js'+e+'"><\/script>'))}function o(){for(var t in s.recaptcha.forms)h.initRecaptchaForm(t)}var c,s,p,r,h={},t="65 100 118 97 110 99 101 100 32 65 110 116 105 32 83 112 97 109 32 71 111 111 103 108 101 32 114 101 67 65 80 84 67 72 65 32 40 99 41 32 67 111 112 121 114 105 103 104 116 32 50 48 49 55 45 50 48 50 48 32 82 101 100 117 120 87 101 98 32 119 119 119 46 114 101 100 117 120 119 101 98 46 110 101 116",u="AdvancedEmailGuard",m=u+"Data",d=u+"InitRecaptcha",l="g-recaptcha-response",f="adveg-grecaptcha",b="adveg-grecaptcha-legal",y=(h.booted=!1,h.recaptchaForms={},h.googleRecaptchaCallback=null,h.googleRecaptchaCallbackBefore=null,h.jqueryReady=null,{}),g={},F=!1,R=0,v=(h.extends=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},h.isObj=function(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)},h.isDef=function(t){return null!=t},h.queryToObj=function(t){var e={};return"string"==typeof t&&(t=0===(t=t.replace(/^\&+|\&+$/g,"")).lastIndexOf("?")?t.substr(1):t).split("&").forEach(function(t){t=t.split("=");e[t[0]]=decodeURIComponent(t[1])}),e},h.strToStudly=function(t){return t.replace(/^[a-z]|([-_][a-z])/gi,function(t){return t.toUpperCase().replace("-","").replace("_","")})},function(t,e,i){y[t]||h.registerFormSelectors(t,e,i)}),k=(h.registerFormSelectors=function(t,e,i){y[t]={form:e,submit:i||"button[type=submit], input[type=submit]"}},function(){var t,e;"v3"===s.recaptcha.type&&(0===(e=$("#"+f)).length&&(t="inline"===s.recaptcha.position?"inline":"fixed",e=$('<div id="'+f+'" class="adveg-grecaptcha-'+t+'" />'),$("body").append(e)),R=grecaptcha.render(f,{sitekey:s.recaptcha.key,badge:s.recaptcha.position,theme:s.recaptcha.theme,size:"invisible"}),s.recaptcha.hidden&&e.hide())}),S=(h.initRecaptchaForm=function(i){if(!h.isDef(y[i]))throw new Error('No selector defined for the "'+i+'" form type.');var a=y[i],n=s.recaptcha.forms[i];if(!h.isDef(n))throw new Error('No params defined for the "'+i+'" form type.');var o=h.strToStudly(i)+"Form",t=(h.isDef(h[o])||(o="RecaptchaForm"),$(a.form));0!==t.length&&(F?t.each(function(){var e=$(this),t=e.find(a.submit).first();h.recaptchaForms[i].some(function(t){return e.is(t.$form)})||h.recaptchaForms[i].push(new h[o](i,n,e,t))}):e(function(){h.initRecaptchaForm(i)}))},h.getRecFormWithToken=function(t){if(h.isDef(h.recaptchaForms[t]))for(var e=0;e<h.recaptchaForms[t].length;e++)if(""!==h.recaptchaForms[t][e].token)return h.recaptchaForms[t][e];return null},h.getRecFormTokenAsPayload=function(t){var e,t=h.getRecFormWithToken(t);return null===t||i()?"":(e=t.token,t.onRecaptchaTokenExpired(),"&"+l+"="+e)},h.getRecV3ID=function(){return R},function(){return"v2_cbx"===s.recaptcha.type||"inline"===s.recaptcha.position}),C=function(){return c.isLegacyOPCEnabled&&"order-opc"===p.pageName};return h.RecaptchaForm=function(t,e,i,a){this.recID=0,this.name=t,this.params=e,this.$form=i,this.$submit=a,this.$inner=null,this.$outer=null,this.token="",this.origHandler=null,this.$gdprCbx=null,this.init()},h.RecaptchaForm.prototype.getFormElement=function(){return this.$form.get(0)},h.RecaptchaForm.prototype.getSubmitElement=function(){return this.$submit.get(0)},h.RecaptchaForm.prototype.init=function(){this.setSubmitHandler(),"v2_cbx"===s.recaptcha.type&&(this.setGDPRHandler(),this.disableSubmitBtn()),"v3"!==s.recaptcha.type&&this.addRecaptchaWidget(),this.$form.addClass("adveg-grecaptcha-form-item-"+this.name)},h.RecaptchaForm.prototype.disableSubmitBtn=function(){this.$submit.prop("disabled",!0).addClass("adveg-grecaptcha-btn-disabled")},h.RecaptchaForm.prototype.enableSubmitBtn=function(){this.$submit.prop("disabled",!1).removeClass("adveg-grecaptcha-btn-disabled")},h.RecaptchaForm.prototype.setGDPRHandler=function(){var t=this.$form.find("input[name=psgdpr_consent_checkbox]");0!==t.length&&(this.$gdprCbx=t,t="."+this.$gdprCbx.attr("class"),$(document).off("change",t),this.$gdprCbx.on("change",this.onGDPRCheckboxChange.bind(this)))},h.RecaptchaForm.prototype.onGDPRCheckboxChange=function(){""!==this.token&&this.isGDPRChecked()?this.enableSubmitBtn():this.disableSubmitBtn()},h.RecaptchaForm.prototype.isGDPRChecked=function(){return null===this.$gdprCbx||this.$gdprCbx.is(":checked")},h.RecaptchaForm.prototype.setSubmitHandler=function(){this.$form.submit(this.onFormSubmit.bind(this))},h.RecaptchaForm.prototype.onFormSubmit=function(t){"v2_cbx"!==s.recaptcha.type&&(""!==this.token?this.insertInputWithToken():("v3"===s.recaptcha.type?(this.disableSubmitBtn(),grecaptcha.execute(R,{action:this.name}).then(this.onRecaptchaToken.bind(this),this.onRecaptchaError.bind(this))):grecaptcha.execute(this.recID),t.preventDefault()))},h.RecaptchaForm.prototype.setSubmitFormHandler=function(){var t=g[this.name];h.isDef(t)?this.swapSubmitHandler(t):h.jqueryReady.then(function(){var t=this.getFormElement(),t=$._data(t,"events");h.isDef(t)&&Array.isArray(t.submit)&&0!==t.submit.length&&(g[this.name]=t.submit[0].handler,this.swapSubmitHandler(g[this.name]))}.bind(this))},h.RecaptchaForm.prototype.swapSubmitHandler=function(t){this.origHandler=t.bind(this.getFormElement()),this.$form.off("submit"),this.$form.submit(this.onFormSubmitProxy.bind(this))},h.RecaptchaForm.prototype.setSubmitClickHandler=function(){var t=g[this.name];h.isDef(t)?this.swapSubmitClickHandler(t):h.jqueryReady.then(function(){var t=this.getSubmitElement(),t=$._data(t,"events");h.isDef(t)&&Array.isArray(t.click)&&0!==t.click.length&&(g[this.name]=t.click[0].handler,this.swapSubmitClickHandler(g[this.name]))}.bind(this))},h.RecaptchaForm.prototype.swapSubmitClickHandler=function(t){this.origHandler=t.bind(this.getSubmitElement()),this.$submit.off("click"),this.$submit.click(this.onFormSubmitProxy.bind(this))},h.RecaptchaForm.prototype.setDocClickHandler=function(e){var t=g[this.name];h.isDef(t)?this.swapDocClickHandler(e,t):h.jqueryReady.then(function(){var t=$._data(document,"events");h.isDef(t)&&Array.isArray(t.click)&&0!==t.click.length&&(t=t.click.find(function(t){return t.selector===e}),h.isDef(t)&&(g[this.name]=t.handler,this.swapDocClickHandler(e,g[this.name])))}.bind(this))},h.RecaptchaForm.prototype.swapDocClickHandler=function(t,e){this.origHandler=e,$(document).off("click",t),$(document).on("click",t,this.onFormSubmitProxy.bind(this))},h.RecaptchaForm.prototype.setGlobalFuncHandler=function(t){var e=g[this.name];h.isDef(e)?this.swapGlobalFuncHandler(t,e):h.isDef(window[t])&&(g[this.name]=window[t],this.swapGlobalFuncHandler(t,g[this.name]))},h.RecaptchaForm.prototype.swapGlobalFuncHandler=function(t,e){this.origHandler=e.bind(window),window[t]=this.onFormSubmitProxy.bind(this)},h.RecaptchaForm.prototype.onFormSubmitProxy=function(t){var e;return"v2_cbx"===s.recaptcha.type?(e=this.origHandler(t),this.disableSubmitBtn(),grecaptcha.reset(this.recID)):""===this.token?("v3"===s.recaptcha.type?(this.disableSubmitBtn(),grecaptcha.execute(R,{action:this.name}).then(this.onRecaptchaToken.bind(this),this.onRecaptchaError.bind(this))):grecaptcha.execute(this.recID),h.isObj(t)&&t.preventDefault&&t.preventDefault()):(this.insertInputWithToken(),e=this.origHandler(t),"v3"===s.recaptcha.type?this.onRecaptchaTokenExpired():grecaptcha.reset(this.recID)),h.isDef(e)?e:!!h.isDef(t)&&void 0},h.RecaptchaForm.prototype.onRecaptchaToken=function(t){this.token=t,("v3"===s.recaptcha.type||"v2_cbx"===s.recaptcha.type&&this.isGDPRChecked())&&this.enableSubmitBtn(),"v2_cbx"!==s.recaptcha.type&&this.submitForm()},h.RecaptchaForm.prototype.onRecaptchaTokenExpired=function(){this.token="","v2_cbx"===s.recaptcha.type&&this.disableSubmitBtn()},h.RecaptchaForm.prototype.onRecaptchaError=function(){"v3"===s.recaptcha.type&&this.enableSubmitBtn(),alert("reCAPTCHA: "+r.genericError)},h.RecaptchaForm.prototype.insertInputWithToken=function(){var t;"v3"!==s.recaptcha.type||i()||(0===(t=this.$form.find("textarea[name="+l+"]")).length&&(t=$('<textarea name="'+l+'" style="display: none;"></textarea>'),this.$form.append(t)),t.val(this.token))},h.RecaptchaForm.prototype.submitForm=function(){this.$submit.click()},h.RecaptchaForm.prototype.addRecaptchaWidget=function(){this.createRecaptchaContainer(),this.insertRecaptchaContainer(),this.renderRecaptchaWidget()},h.RecaptchaForm.prototype.createRecaptchaContainer=function(){var t;this.$inner=$('<div class="adveg-grecaptcha" />'),this.$outer=this.$inner,S()?(this.$inner.addClass("adveg-grecaptcha-inline"),t=this.$submit.parent().parent().hasClass("row"),"offset"===this.params.align?(this.$outer=this.$inner.wrap("<div />").parent(),this.$outer.addClass("col-md-"+(12-this.params.offset)+" col-md-offset-"+this.params.offset+" offset-md-"+this.params.offset),t||(this.$outer=this.$outer.wrap('<div class="row" />').parent())):(this.$inner.addClass("adveg-grecaptcha-"+this.params.align),t&&(this.$outer=this.$outer.wrap('<div class="col-xs-12" />').parent()))):this.$inner.addClass("adveg-grecaptcha-fixed")},h.RecaptchaForm.prototype.insertRecaptchaContainer=function(){(this.$submit.parent().is(this.$form)?this.$submit:this.$submit.parent()).before(this.$outer),S()&&this.$outer.before('<div class="clearfix" />')},h.RecaptchaForm.prototype.renderRecaptchaWidget=function(){this.recID=grecaptcha.render(this.getWidgetContainer(),this.getRecaptchaParams()),s.recaptcha.hidden&&this.hideWidget()},h.RecaptchaForm.prototype.getRecaptchaParams=function(){var t={sitekey:s.recaptcha.key,callback:this.onRecaptchaToken.bind(this),"expired-callback":this.onRecaptchaTokenExpired.bind(this),"error-callback":this.onRecaptchaError.bind(this),theme:s.recaptcha.theme};return"v2_cbx"===s.recaptcha.type?t.size=this.params.size:(t.size="invisible",t.isolated=!0,t.badge=s.recaptcha.position),t},h.RecaptchaForm.prototype.getWidgetContainer=function(){return this.$inner.get(0)},h.RecaptchaForm.prototype.hideWidget=function(){"v3"!==s.recaptcha.type&&this.$outer.hide()},h.RegisterForm=function(t,e,i,a){h.RecaptchaForm.call(this,t,e,i,a)},h.extends(h.RegisterForm,h.RecaptchaForm),h.RegisterForm.prototype.setSubmitHandler=function(){C()?p.ps.v16?this.setDocClickHandler("#submitAccount, #submitGuestAccount"):this.setSubmitClickHandler():h.RecaptchaForm.prototype.setSubmitHandler.call(this)},h.RegisterForm.prototype.insertRecaptchaContainer=function(){p.ps.v15&&!C()&&0!==this.$form.find("fieldset").length?this.$form.find("fieldset:last").append(this.$outer):h.RecaptchaForm.prototype.insertRecaptchaContainer.call(this)},h.LoginForm=function(t,e,i,a){h.RecaptchaForm.call(this,t,e,i,a)},h.extends(h.LoginForm,h.RecaptchaForm),h.LoginForm.prototype.onFormSubmit=function(t){p.ps.v17ch&&"order"===p.pageName&&this.$form.data("disabled",!1),h.RecaptchaForm.prototype.onFormSubmit.call(this,t)},h.LoginForm.prototype.setSubmitHandler=function(){C()?p.ps.v16?this.setDocClickHandler("#SubmitLogin"):this.setSubmitClickHandler():h.RecaptchaForm.prototype.setSubmitHandler.call(this)},h.QuickOrderForm=function(t,e,i,a){h.RecaptchaForm.call(this,t,e,i,a)},h.extends(h.QuickOrderForm,h.RecaptchaForm),h.QuickOrderForm.prototype.setSubmitHandler=function(){C()?p.ps.v16?this.setDocClickHandler("#submitAccount, #submitGuestAccount"):this.setSubmitClickHandler():h.RecaptchaForm.prototype.setSubmitHandler.call(this)},h.QuickOrderForm.prototype.onFormSubmit=function(t){p.ps.v17ch&&this.$form.data("disabled",!1),h.RecaptchaForm.prototype.onFormSubmit.call(this,t)},h.QuickOrderForm.prototype.insertRecaptchaContainer=function(){p.ps.v16&&!C()&&0!==this.$form.find(".box").length?this.$form.find(".box:last").append(this.$outer):p.ps.v15&&!C()&&0!==this.$form.find("fieldset:last").length?this.$form.find("fieldset:last").append(this.$outer):h.RecaptchaForm.prototype.insertRecaptchaContainer.call(this)},h.NewsletterForm=function(t,e,i,a){h.RecaptchaForm.call(this,t,e,i,a)},h.extends(h.NewsletterForm,h.RecaptchaForm),h.NewsletterForm.prototype.insertRecaptchaContainer=function(){"flex"===this.$submit.closest("div").css("display")?this.$submit.closest("div").before(this.$outer):h.RecaptchaForm.prototype.insertRecaptchaContainer.call(this)},h.NewsletterForm.prototype.setSubmitHandler=function(){h.isDef(window.psemailsubscription_subscription)?h.jqueryReady.then(function(){h.isDef($._data(this.getFormElement(),"events"))?this.setSubmitFormHandler():h.RecaptchaForm.prototype.setSubmitHandler.call(this)}.bind(this)):h.RecaptchaForm.prototype.setSubmitHandler.call(this)},h.WriteReviewForm=function(t,e,i,a){h.RecaptchaForm.call(this,t,e,i,a)},h.extends(h.WriteReviewForm,h.RecaptchaForm),h.WriteReviewForm.prototype.setSubmitHandler=function(){p.ps.v17pc?this.setSubmitFormHandler():p.ps.v16?this.setDocClickHandler("#"+this.$submit.attr("id")):this.setSubmitClickHandler()},h.WriteReviewForm.prototype.insertRecaptchaContainer=function(){p.ps.v17pc?(this.$submit.parent().before(this.$outer),S()?this.$submit.closest(".post-comment-buttons").addClass("offset-md-6 offset-sm-6 col-md-offset-6 col-sm-offset-6"):function(){for(var t in h.recaptchaForms)if(0<h.recaptchaForms[t].length)return!0;return!1}()||this.$form.closest(".modal-dialog").attr("style","-webkit-transform: none!important; transform: none!important;")):h.RecaptchaForm.prototype.insertRecaptchaContainer.call(this)},h.NotifyWhenInStockForm=function(t,e,i,a){h.RecaptchaForm.call(this,t,e,i,a)},h.extends(h.NotifyWhenInStockForm,h.RecaptchaForm),h.NotifyWhenInStockForm.prototype.setSubmitHandler=function(){!c.isLegacyMAModuleEnabled&&this.$submit.hasClass("js-mailalert-add")?this.setDocClickHandler(".js-mailalert-add"):this.setGlobalFuncHandler("addNotification")},h.NotifyWhenInStockForm.prototype.swapDocClickHandler=function(t,e){!c.isLegacyMAModuleEnabled&&this.$submit.hasClass("js-mailalert-add")&&(e=e.bind(this.getSubmitElement())),h.RecaptchaForm.prototype.swapDocClickHandler.apply(this,[t,e])},h.NotifyWhenInStockForm.prototype.insertRecaptchaContainer=function(){this.$submit.before(this.$outer)},h.SendToFriendForm=function(t,e,i,a){h.RecaptchaForm.call(this,t,e,i,a)},h.extends(h.SendToFriendForm,h.RecaptchaForm),h.SendToFriendForm.prototype.setSubmitHandler=function(){this.setSubmitClickHandler()},h.run=function(){var t,e,i;return h.booted||(h.isObj(window[m])&&(h.jqueryReady=new Promise(function(t){$.isReady?t():$(function(){t()})}),i=window[m],c=i.meta,s=i.settings,p=i.context,r=i.trans,null!==c.validationError&&(t=0,(e=$('<div id="adveg-validation-failed" style="display: none;"><div><div>'+c.validationError+'</div><button type="button"><span>&times;</span></button></div></div>')).appendTo("body"),e.find("button:first").on("click",function(){clearTimeout(t),e.slideUp(200)}),setTimeout(function(){e.slideDown(200),t=setTimeout(function(){e.slideUp(200)},4500)},700)),n()),h.booted=!0),a},h}();document.addEventListener("DOMContentLoaded",AdvancedEmailGuard.run);
